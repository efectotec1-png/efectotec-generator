<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>efectoTEC Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-3px); } 100% { transform: translateY(0px); } }
        .robot-float { animation: float 3s ease-in-out infinite; }
        /* Ultra Compact Mode */
        body { font-size: 13px; } 
    </style>
</head>
<body class="bg-gradient-to-b from-slate-50 to-blue-50 min-h-screen flex items-center justify-center font-sans p-2">

    <div class="bg-white p-4 rounded-xl shadow-xl w-full max-w-md border border-slate-200 relative overflow-hidden">
        
        <div class="text-center mb-3 relative z-10">
            <p class="text-blue-600 tracking-wider text-[10px] mb-1">
                <span class="font-bold">efecto</span>TEC
            </p>
            <h1 class="text-lg font-bold text-slate-800 leading-tight">Schulaufgaben Generator</h1>
            <p class="text-slate-400 text-[10px] mt-1">we ‚ù§Ô∏è ROBOTs</p>
        </div>

        <div class="border-2 border-dashed border-blue-200 rounded-lg p-4 text-center bg-blue-50 hover:bg-blue-100 transition-colors cursor-pointer relative" id="dropZone">
            <div class="robot-float mb-2 text-2xl">ü§ñ</div>
            <p class="text-slate-600 font-medium text-xs">Hefteintrag hier ablegen</p>
            <p class="text-slate-400 text-[10px]">oder klicken zum Hochladen</p>
            <input type="file" id="fileInput" name="hefteintrag" accept="image/*" multiple class="absolute inset-0 opacity-0 cursor-pointer">
        </div>

        <div id="fileList" class="mt-3 space-y-2 hidden"></div>

        <div id="step-config" class="mt-4 hidden animate-fade-in">
            <div class="grid grid-cols-2 gap-2">
                <button onclick="submitGeneration('ex')" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg text-xs font-semibold shadow-md transition-all flex flex-col items-center">
                    <i class="fas fa-bolt mb-1"></i>
                    <span>Stegreifaufgabe</span>
                    <span class="text-[9px] opacity-80 font-normal">20 Min / 1 Seite</span>
                </button>
                <button onclick="submitGeneration('sa')" class="bg-slate-800 hover:bg-slate-900 text-white p-2 rounded-lg text-xs font-semibold shadow-md transition-all flex flex-col items-center">
                    <i class="fas fa-graduation-cap mb-1"></i>
                    <span>Schulaufgabe</span>
                    <span class="text-[9px] opacity-80 font-normal">60 Min / Umfangreich</span>
                </button>
            </div>
        </div>

        <div id="loading" class="hidden mt-4 text-center py-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
            <p id="loading-text" class="text-slate-600 text-xs animate-pulse">Analysiere...</p>
        </div>

        <div class="mt-4 pt-2 border-t border-slate-100 flex justify-between items-center text-[9px] text-slate-400">
            <span>v1.6 | G9-Ready</span>
            <span class="flex items-center gap-1"><i class="fas fa-lock text-green-500"></i> Datenschutz aktiv</span>
        </div>

    </div>

    <form id="generateForm" class="hidden"></form>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const stepConfig = document.getElementById('step-config');
        let collectedFiles = [];

        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (files.length > 0) {
                Array.from(files).forEach(file => collectedFiles.push(file));
                updateUI();
            }
        }

        function updateUI() {
            fileList.innerHTML = '';
            if (collectedFiles.length > 0) {
                fileList.classList.remove('hidden');
                stepConfig.classList.remove('hidden');
                
                collectedFiles.forEach((file, index) => {
                    const div = document.createElement('div');
                    div.className = "flex justify-between items-center bg-slate-50 p-2 rounded border border-slate-100 text-xs";
                    div.innerHTML = `
                        <span class="truncate max-w-[150px] text-slate-600"><i class="fas fa-image text-blue-400 mr-2"></i>${file.name}</span>
                        <button onclick="removeFile(${index})" class="text-red-400 hover:text-red-600"><i class="fas fa-times"></i></button>
                    `;
                    fileList.appendChild(div);
                });
            } else {
                fileList.classList.add('hidden');
                stepConfig.classList.add('hidden');
            }
        }

        function removeFile(index) {
            collectedFiles.splice(index, 1);
            updateUI();
        }

        async function submitGeneration(type) {
            document.getElementById('step-config').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            
            // Wording gem√§√ü Lastenheft v7.0
            const loadingText = document.getElementById('loading-text');
            loadingText.innerText = "Ich entschl√ºssle deine Sauklaue üòÇ";
            
            // Zweite Stufe der Animation simulieren
            setTimeout(() => {
                loadingText.innerText = "Schreibe Pr√ºfung... (ca. 20s)";
            }, 3000);

            const formData = new FormData(document.getElementById('generateForm'));
            collectedFiles.forEach(file => formData.append('hefteintrag', file));
            formData.append('examType', type);

            try {
                const res = await fetch('/generate', { method: 'POST', body: formData });
                if (!res.ok) throw new Error(await res.text());
                
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `efectoTEC_${type.toUpperCase()}.pdf`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                
                loadingText.innerText = "Fertig! PDF wird geladen.";
                setTimeout(() => location.reload(), 3000);
            } catch (err) {
                alert("Fehler: " + err.message);
                location.reload();
            }
        }
    </script>
</body>
</html>